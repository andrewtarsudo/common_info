# Назначение

Основное назначение программы - получение списка работ (IssueWorkItem), созданных на YouTrack за определенный промежуток времени, а также дедлайн задач (Issue), к которым привязаны эти работы. Для каждой работы отображается дата создания, номер задачи на YouTrack и затраченное время. При необходимости результаты можно сохранить в TXT-файл с возможностью перезаписи при указании уже существующего.

Формат вывода:
```
----------
Дата: <ДД месяц ГГГГ> г
Задача: <название проекта-номер задачи>
Затраченное время: <затраченное время> мин, для таблицы: <модифицированное затраченное время> ч
Дедлайн/deadline: <ДД месяц ГГГГ> г, для таблицы: <ДД.ММ.ГГГГ>
----------
```

**Примечание** - для некоторых задач дедлайн не задан. В таких случаях будет указано, что он отсутствует, и последняя строка будет иметь вид:
```
Дедлайн/deadline: не задан
```

Выводимая информация группируется по дате добавления затраченного времени на YouTrack для каждого дня в промежутке. Группа также может быть пуста.

# Требования для успешной работы программы

Для корректной работы необходимо выполнение следующих условий:
* постоянный токен авторизации на Youtrack для формирования и отправки запросов по YouTrack REST API и авторизации на ресурсе. Инструкция по созданию токена приведена [ниже](#создание-постоянного-токена-авторизации-youtrack);
* файл youtrack.json с параметрами авторизации на YouTrack (логин, постоянный токен) и временной меткой последнего запуска (необязательно). Работа с файлом описана в соответствующем [разделе](#файл-youtrack.json);

**Примечание 1.** Файл youtrack.json не пересылается, а его параметры используются лишь для запросов. Таким образом, безопасность данных равна безопасности внутренней сети компании или VPN.

**Примечание 2.** Файл youtrack.json можно не использовать при небольшой модификации кода при необходимости. В таком случае обратитесь по указанным внизу страницы [контактам](#контакты).

* название файла youtrack.json не изменялось. При следующем расширении функционала будет изменено;
* исполняемый файл yt_lite.exe и файл конфигурации youtrack.json должны находиться в одной директории. В планах ослабить это требование или же вовсе избавиться.

# Файл youtrack.json

## Создание постоянного токена авторизации YouTrack

### Схема действий и переходов для создания токена:

YouTrack -> Профиль/Profile -> Аккаунт Hub/Hub account -> Обновление анкетных данных и управление логинами/Update personal information and manage logins -> Аутентификация/Authentication -> Новый токен.../New token... -> заполнить Имя/Name -> добавить пункт YouTrack в Область доступа/Scope -> Создать/Create -> Сохранить в буфер обмена/Save to the buffer -> открыть youtrack.json -> вставить из буфера в параметр auth_token -> задать значение параметру login (-> задать значение параметру timestamp)

### Пошаговый алгоритм:

1) нажать на аватар на верхней панели YouTrack;
2) выбрать `"Профиль"`/`"Profile"` в выпавшем меню;
3) нажать на `"Обновление анкетных данных и управление логинами"`/`"Update personal information and manage logins"` в пункте `"Аккаунт Hub"`/`"Hub account"`;
4) нажать на `"Аутентификация"`/`"Authentication"` в верхней панели пользователя;
5) нажать на `"Новый токен..."`/`"New token..."`;
6) задать имя (любое);
7) добавить в поле `"Область доступа"`/`"Scope"` пункт YouTrack (наличие/отсутствие пункта Hub не имеет значения);
8) нажать на кнопку `"Создать"`/`"Create"`;
9) скопировать полученную строку целиком, включая `perm:`;

**Примечание** - при отсутствии `perm:` в начале токена будет добавлено автоматически.

10) открыть в блокноте (Notepad.exe) файл `youtrack.json`;
11) ввести в поле `"auth_token"` строку, сохраненную из п. 9;
12) ввести в поле `"login"` имя на YouTrack (чаще всего `"фамилия_на_английском"`, иногда `"фамилия_на_английском-первая_буква_имени"`);
13) ввести в поле `"timestamp"` дату начала периода, за который запрашивается затраченное время.

#### Внимание! Добавление пункта YouTrack на шаге 7 обязательно, в ином случае на все запросы YouTrack будет отвечать ошибкой авторизации.

**Примечание** - шаг 13 опционален, период можно задать вручную при запуске программы.

_Скриншоты будут добавлены в ближайшем, но неопределенном будущем. Если не забуду, или меня не поборет лень._

## Описание параметров

Файл youtrack.json имеет следующую структуру:
```
{
  "login": "your_login_in_YouTrack",
  "auth_token": "perm: auto_generated_token",
  "timestamp": "date_in_format_YYYY-MM-DD"
}
```
* login - логин на YouTrack, чаще всего в формате <фамилия_англ> или <фамилия_англ-первая_буква_имени> (tarasov-a);
* auth_token - постоянный токен авторизации YouTrack. Описание создания токена описано [выше](#пошаговый-алгоритм);
* timestamp - временная метка последнего использования программы в формате ISO: ГГГГ-ММ-ДД.

По умолчанию, timestamp = первый день текущего года (2022-01-01).

Пример файла находится [здесь](/yt_lite/youtrack.json).

## Редактирование файла

При изменении файла необходимо учитывать следующие моменты:
* и параметры, и значения должны быть заключены в кавычки;
* кавычки только двойные ("), не одинарные (');
* в конце каждой строки, кроме последней, должна стоять запятая. То есть строки разделяются запятыми;
* формат timestamp - ГГГГ-ММ-ДД. Иные форматы считаются некорректными, и тогда будут использоваться значения по умолчанию, если не задать вручную во время работы программы. В планах расширить диапазон воспринимаемых форматов.
* в самом начале файла должна находиться открывающая фигурная скобка '{', в конце файла - закрывающая скобка '}'.

#### tl;dr Все указанные моменты будут соблюдаться, если заменить только лишь значения внутри кавычек, не включая кавычки.

**Примечание** - при неудобстве работы в таком виде обратитесь по указанным внизу страницы [контактам](#контакты). Параметр login не меняется, параметр auth_token тоже не меняется, кроме случаев его разглашения, соответственно, возможно задание значений вручную при небольшом изменении кода программы.

# Работа программы

## Ввод пользователя

#### При вводе строки __exit__ (допускается как без кавычек, так и с любыми кавычками) при запросе данных от программы выполнение всех действий прекращается, а окно закрывается.

При отсутствии файла youtrack.json 

В течение работы программы у пользователя будут запрошены следующие данные:

---- (1) начальная дата периода. Формат: ГГГГ-ММ-ДД. Значение по умолчанию - значение timestamp из файла youtrack.json. При отсутствии значения или его некорректности в файле используется первый день текущего года (2022-01-01);

---- (2) конечная дата периода. Формат: ГГГГ-ММ-ДД. Значение по умолчанию - текущий день. При отсутствии значения или его некорректности в файле используется текущий день;

**Примечание** - если начальная дата находится позже конечной даты в календаре, то используется значения по умолчанию.

---- (3) сохранение результатов работы в текстовый TXT-файл.

**Примечание** - текстовые сообщения программы или выводимые ошибки в файл не записываются.

* Чтобы сохранить данные, введите название TXT-файла без расширения, до '.txt' (для файла test.txt введите test). При вводе названия с расширением '.txt' будет автоматически удалено.

* Чтобы не сохранять данные, нажмите "Enter". После этого через небольшой промежуток времени программа прекратит работу, а окно закроется.

-------- (4) если указанный файл не существует, то он будет создан, а в него будет записаны результаты. После оповещения времени программа прекратит работу, а окно закроется.

-------- (5) если указанный файл уже существует, то будет запрошено подтверждение перезаписи. По умолчанию - отмена перезаписи.

* Чтобы перезаписать содержимое файла, введите Y или Д (Yes/Да). Регистр не важен.

* Чтобы отменить изменение файла, введите любую другую строку или нажмите "Enter".

------------ (6) если перезапись отменена, то осуществляется возврат к пункту (3).

Создается или изменяется файл, находящийся в той же директории, где находятся yt_lite.exe и youtrack.json. При следующем расширении функционала привязка к файлам программы будет убрана.

## Вывод программы

По завершении всех действий на экран выводится вышеуказанная информация в формате:

* если дедлайн задан:
```
----------
Дата: <ДД месяц ГГГГ> г
Задача: <название проекта-номер задачи>
Затраченное время: <затраченное время> мин, для таблицы: <модифицированное затраченное время> ч
Дедлайн/deadline: <ДД месяц ГГГГ> г, для таблицы: <ДД.ММ.ГГГГ>
----------
```
* если дедлайн не задан:
```
----------
Дата: <ДД месяц ГГГГ> г
Задача: <название проекта-номер задачи>
Затраченное время: <затраченное время> мин, для таблицы: <модифицированное затраченное время> ч
Дедлайн/deadline: не задан
----------
```
* Дата - календарный день, когда было создано затраченное время. Формат: <ДД месяц ГГГГ> г (01 января 2022 г);
* Задача - имя задачи, к которой относится затраченное время. Формат: <название проекта-номер задачи> (DOC_ST-1);
* Затраченное время - количество времени, зарегистрированное в YouTrack. Формат: <затраченное время> мин (450 мин);
* Затраченное время, для таблицы - количество времени, которое будет внесено в таблицу. Формат: <модифицированное затраченное время> ч (7.5 мин);
* Дедлайн/deadline - дата крайнего срока завершения задачи в формате YouTrack. Формат: <ДД месяц ГГГГ> г (2 февраля 2021 г);
* Дедлайн/deadline, для таблицы - дата крайнего срока завершения задачи в формате, заданном в таблице. Формат: <ДД.ММ.ГГГГ>.

**Примечание** - вид записи месяца словом и разделитель целой и дробной части числа зависит от языка интерфейса операционной системы ().

# Контакты
* 303 кабинет
* Mattermost: @tarasov-a
* Telegram: @andrew.tar
