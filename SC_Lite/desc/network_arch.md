---
title : "Взаимодействие с внешними узлами"
description : ""
weight : 6
---

### Взаимодействие с ESME

Для организации дополнительных услуг на базе технологий SMS и USSD система PROTEI SC_Lite взаимодействует с сервисными приложениями по протоколу <a href="https://smpp.org/SMPP_v3_4_Issue1_2.pdf">SMPP over TCP/IP v3.4</a>.

В протоколе SMPP определены три алгоритма обмена сообщениями (режима работы). PROTEI SC_Lite поддерживает следующие:

- режим с промежуточным хранением сообщений, Store and Forward;
- режим транзакции, Transaction mode.

Если PROTEI SC_Lite выполняет роль USSD–шлюза, взаимодействие USSD–приложений с системой должно осуществляться только по алгоритму с промежуточным хранением сообщения Store and Forward mode, хотя фактического промежуточного хранения USSD–сообщений не осуществляется.

В рекомендации <a href="https://smpp.org/SMPP_v3_4_Issue1_2.pdf#%5B%7B%22num%22%3A542%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2Cnull%2C769%2Cnull%5D">SMPP v3.4</a> определены три режима работы по SMPP–соединению:
- режим передачи, tx - осуществляется передача сообщений от внешних приложений к PROTEI SC_Lite;
- режим приема, rx - осуществляется прием сообщений внешними приложениями от PROTEI SC_Lite;
- режим приемопередачи, trx - осуществляется и прием, и передача сообщений между внешними приложениями и системой PROTEI SC_Lite.

PROTEI SC_Lite поддерживает следующие значения параметра system_type:

- null - сообщение обрабатывается как обычное MT‒SMS;
- RAW - сообщение обрабатывается как обычное MT‒SMS;
- MO‒SMS - обязательно наличие параметров qos_time_to_live и dest_subaddress. В иных случаях сообщение отбивается. Далее сообщение обрабатывается как обычное MT‒SMS, но без отправки запроса MAP‒SRI‒SM.

### Взаимодействие с MSC

Шлюз PROTEI SC_Lite подключается к мобильному коммутатору MSC сети стандарта GSM Phase 2/2+ по цифровым трактам E1.

Взаимодействие с мобильной сетью стандарта GSM Phase 2/2+ осуществляется по SS7 и SIGTRAN. Поддерживается возможность работы по протоколу MAP версии 1, 2 и 3, SCCP class 0 и class 1. Для протоколов MTP Layer–3 и SCCP оборудование представляет собой сигнальный терминал без использования функций STP.

Обеспечивается поддержка до 16 звеньев сигнализации внутри одного сета.

#### Описание встроенных USSD–сервисов

|Команда|Ответ|Назначение|Комментарий|
|:------|:----|:---------|:----------|
|\*555#|test service \*555#|Тестовый запуск.||
|\*556#|Greetings! Please enter something|Ввод ответного текста и получение его обратно.|Можно использовать для тестирования ввода русского языка абонентом в ответном USSD–сообщении, если это позволяет устройство.|
|Hello|Thanks! You have entered Hello|Ввод ответного текста и получение его обратно.|Можно использовать для тестирования ввода русского языка абонентом в ответном USSD–сообщении, если это позволяет устройство.|
|\*557#|Русское сообщение Unicode|Информация о поддержке русского языка.||
|\*558\*100#|USSDv2...1.........2<br>......3.........4.........<br>5.........6.........7...<br>......8.........9.....10|Информация о максимально возможной длине USSD–сообщения.|\*558\* - номер доступа к службе;<br>100# - количество символов в USSD;<br>USSDv 2 - версия USSD;<br>...1.....2..... - формат вывода количества запрошенных символов с разбивкой по десяткам.|

### Взаимодействие с BRT

Организация тарификации может осуществляться в следующих режимах:

- off_line - снятие средств со счета производится после предоставления услуги;
- real–time - снятие средств в режиме реального времени во время предоставления услуги;
- scenario - тарификация по заранее определенному сценарию.

#### Алгоритм биллинга:

1. При поступлении от абонента запроса на услугу MSC формирует сообщение протокола MAP с кодом сервиса и данными абонента и передает его SC_Lite.
2. SC_Lite проверяет соответствие полученных номеров абонентов белым/черным спискам.
**Примечание**. Если номер попадает под черный список, то осуществляется заранее определенный сценарий без обращения к BRT.
3. Если номер абонента соответствует белому списку, SC_Lite преобразует полученные данные и посылает по протоколу BRT запрос в OCS оператора на получение информации о разрешении использования сервиса данному абоненту и предельно допустимой длительности транзакции.
4. Получив ответ, SC_Lite по протоколу MAP отдает инструкции MSC на продолжение обслуживания сервиса или отказ.
5. После завершения абонентом использования услуги MSC по протоколу MAP передает SC_Lite результат отправки SMS.
6. SC_Lite пересылает данную информацию в OCS.
7. OCS на основании полученной информации осуществляет тарификацию услуги.
8. В случае недоступности биллинговой системы обеспечивается возможность задания сценария обслуживания вызова по умолчанию, например, запрет или разрешение отправки SMS.
